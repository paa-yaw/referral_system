<div class="col-md-12">
	<div class="card">
		<div class="card-header" data-background-color="purple">
			<h4 class="title">News Feed</h4>
			<p class="category">Real life feed of activities</p>
		</div>
		<div class="card-content table-responsive">
			<table class="table">
				<thead class="text-primary">
					<th>Stories</th>
					<th>Timestamp</th>
				</thead>
				<tbody>
				<% if @feed.any? %>
					<% @feed.each do |activity| %>
					<% if activity.action == "create" && activity.trackable_type == "Company" %>   
					<tr>
					    <% if !activity.trackable.nil? %>
						<td><span class="text-primary"><%= activity.user.username %></span> just brought in 
						<% if activity.trackable.user != current_user %>
							<span class="dropdown">
								<a href="#" class="dropdown-toggle btn btn-primary btn-xs btn-round" data-toggle="dropdown">
									<%= activity.trackable.alias_name %>
								</a>
							</span>
						<% else %>
						  <span class="text-primary btn btn-primary btn-xs btn-round"><%= activity.trackable.alias_name %>	
						  </span>
						<% end %>NOTE: no deal has been made yet!
						</td>
						<td><%= activity.updated_at.strftime("%B %d, %Y") %> at <%= activity.updated_at.strftime("%r") %></td>
					  <% end %>	
					</tr>

					<% elsif activity.action == "update" && activity.trackable_type == "Company" %>   
					<tr>
					    <% if !activity.trackable.nil? %>
						<td><span class="text-primary"><%= activity.user.username %></span> just brought in 
						<% if activity.trackable.user != current_user %>
							<span class="dropdown">
								<a href="#" class="dropdown-toggle btn btn-primary btn-xs btn-round" data-toggle="dropdown">
									<%= activity.trackable.alias_name %>
								</a>
							</span>
						<% else %>
						  <span class="text-primary btn btn-primary btn-xs btn-round"><%= activity.trackable.alias_name %>	
						  </span>
						<% end %>NOTE: no deal has been made yet!
						</td>
						<td><%= activity.updated_at.strftime("%B %d, %Y") %> at <%= activity.updated_at.strftime("%r") %></td>
					  <% end %>	
					</tr>
					<% elsif activity.action == "deal" && activity.trackable_type == "Company" %>
					  <tr>
					    <% if !activity.trackable.nil? %>
						<td><span class="text-primary">The Agency</span> just made a deal with
						<% if activity.trackable.user != current_user %>
							<span class="dropdown">
								<a href="#" class="dropdown-toggle btn btn-primary btn-xs btn-round" data-toggle="dropdown">
									<%= activity.trackable.alias_name %>
								</a>
								<ul class="dropdown-menu">
									<li>
									<% if activity.trackable.job_descriptions.any? %>
									<%= link_to pluralize(activity.trackable.job_descriptions.count, "Job Description"), company_job_descriptions_url(activity.trackable) %>
									<% else %>
									No Role has been posted
									<% end %>	
									</li>
								</ul>
							</span>
						<% else %>
						  <span class="text-primary btn btn-primary btn-xs btn-round"><%= activity.trackable.alias_name %>	
						  </span>
						<% end %> brought in by <span class="text-primary"><%= activity.trackable.user.username %></span>
						</td>
						<td><%= activity.updated_at.strftime("%B %d, %Y") %> at <%= activity.updated_at.strftime("%r") %></td>
					  <% end %>	
					</tr>
					<% elsif activity.action == "added an applicant" && activity.trackable_type == "Applicant" %>
					<tr>
					    <% if !activity.trackable.nil? %>
						<td><span class="text-primary"><%= activity.user.username %></span> just brought in 
						<% if activity.trackable.company.user != current_user %>
							<span class="dropdown">
								<a href="#" class="dropdown-toggle btn btn-primary btn-xs btn-round" data-toggle="dropdown">
									<%= activity.trackable.name %>
								</a>
							</span> to <span class="btn btn-primary btn-round btn-xs"><%= activity.trackable.company.alias_name %></span> for a role as:
							<span class="dropdown">
								<a href="#" class="dropdown-toggle btn btn-default btn-xs btn-round" data-toggle="dropdown">
									<%= activity.trackable.job_description.job_title %>
								</a>
								<ul class="dropdown-menu">
									<li>
									<% if activity.trackable.job_description.applicants.count != activity.trackable.job_description.vacancies %>

									  <%= link_to new_job_description_applicant_url(activity.trackable.job_description) do %>
									    <i class="material-icons">add</i>applicant
									  <% end %>
									<% else %>
									<p>No more vacancies</p>  
									<% end %>  									
									</li>
								</ul>
							</span>
						<% else %>
						  <span class="text-primary btn btn-primary btn-xs btn-round"><%= activity.trackable.name %>	
						  </span> to <span class="btn btn-primary btn-round btn-xs"><%= activity.trackable.company.alias_name %></span>  for a role as: 
						  <span class="text-primary btn btn-default btn-xs btn-round">
									<%= activity.trackable.job_description.job_title %>
						  </span>
						<% end %>	
						</td>
						<td><%= activity.updated_at.strftime("%B %d, %Y") %> at <%= activity.updated_at.strftime("%r") %></td>
					  <% end %>	
					</tr>	
					<% elsif activity.action == "update" && activity.trackable_type == "Applicant" %>
					<tr>
					    <% if !activity.trackable.nil? %>
						<td><span class="text-primary"><%= activity.user.username %></span> just brought in 
						<% if activity.trackable.company.user != current_user %>
							<span class="dropdown">
								<a href="#" class="dropdown-toggle btn btn-primary btn-xs btn-round" data-toggle="dropdown">
									<%= activity.trackable.name %>
								</a>
							</span> to <span class="btn btn-primary btn-round btn-xs"><%= activity.trackable.company.alias_name %></span> for a role as:
							<span class="dropdown">
								<a href="#" class="dropdown-toggle btn btn-default btn-xs btn-round" data-toggle="dropdown">
									<%= activity.trackable.job_description.job_title %>
								</a>
								<ul class="dropdown-menu">
									<li>
									<% if activity.trackable.job_description.applicants.count != activity.trackable.job_description.vacancies %>

									  <%= link_to new_job_description_applicant_url(activity.trackable.job_description) do %>
									    <i class="material-icons">add</i>applicant
									  <% end %>
									<% else %>
									<p>No more vacancies</p>  
									<% end %>  									
									</li>
								</ul>
							</span>
						<% else %>
						  <span class="text-primary btn btn-primary btn-xs btn-round"><%= activity.trackable.name %>	
						  </span> to <span class="btn btn-primary btn-round btn-xs"><%= activity.trackable.company.alias_name %></span>  for a role as: 
						  <span class="text-primary btn btn-default btn-xs btn-round">
									<%= activity.trackable.job_description.job_title %>
						  </span>
						<% end %>	
						</td>
						<td><%= activity.updated_at.strftime("%B %d, %Y") %> at <%= activity.updated_at.strftime("%r") %></td>
					  <% end %>	
					</tr>	
					<% elsif activity.action == "create" && (activity.trackable_type == "JobDescription" && activity.permitted? ) %>
					<tr>
					  <% if !activity.trackable.nil? %>
					    <td><span class="btn btn-primary btn-xs btn-round"><%= activity.trackable.company.alias_name %></span> is looking for <%= pluralize(activity.trackable.vacancies, "applicant") %> to fill the role of
					    <% if activity.trackable.company.user != current_user %>
					      <span class="dropdown">
								<a href="#" class="dropdown-toggle btn btn-default btn-xs btn-round" data-toggle="dropdown">
									<%= activity.trackable.job_title %>
								</a>
								<ul class="dropdown-menu">
									<li>
									<% if activity.trackable.applicants.any? && activity.trackable.applicants.count != activity.trackable.vacancies %>

									<%= link_to new_job_description_applicant_url(activity.trackable) do %>
									  <i class="material-icons">add</i>applicant
									<% end %>

									<% elsif activity.trackable.applicants.any? && activity.trackable.applicants.count == activity.trackable.vacancies %>
									<p>No more vacancies</p>

									<% elsif activity.trackable.applicants.empty? %> 									
									<%= link_to new_job_description_applicant_url(activity.trackable) do %>
									  <i class="material-icons">add</i>applicant
									<% end %>
									<% end %>	
									</li>
								</ul>
							</span>
						<% else %>
						  <span class="btn btn-default btn-xs btn-round"><%= activity.trackable.job_title %></span>
					    <% end %>
					    </td>
					    <td><%= activity.updated_at.strftime("%B %d, %Y") %> at <%= activity.updated_at.strftime("%r") %></td>
					  <% end %>	
					</tr>

					<% elsif activity.action == "update" && activity.trackable_type == "JobDescription" %>
					<tr>
					  <% if !activity.trackable.nil? %>
					    <td><span class="btn btn-primary btn-xs btn-round"><%= activity.trackable.company.alias_name %></span> is looking for <%= pluralize(activity.trackable.vacancies, "applicant") %> to fill the role of
					    <% if activity.trackable.company.user != current_user %>
					      <span class="dropdown">
								<a href="#" class="dropdown-toggle btn btn-default btn-xs btn-round" data-toggle="dropdown">
									<%= activity.trackable.job_title %>
								</a>
								<ul class="dropdown-menu">
									<li>
									<% if activity.trackable.applicants.any? && activity.trackable.applicants.count != activity.trackable.vacancies %>

									<%= link_to new_job_description_applicant_url(activity.trackable) do %>
									  <i class="material-icons">add</i>applicant
									<% end %>

									<% elsif activity.trackable.applicants.any? && activity.trackable.applicants.count == activity.trackable.vacancies %>
									<p>No more vacancies</p>

									<% elsif activity.trackable.applicants.empty? %> 									
									<%= link_to new_job_description_applicant_url(activity.trackable) do %>
									  <i class="material-icons">add</i>applicant
									<% end %>
									<% end %>	
									</li>
								</ul>
							</span>
						<% else %>
						  <span class="btn btn-default btn-xs btn-round"><%= activity.trackable.job_title %></span>
					    <% end %>
					    </td>
					    <td><%= activity.updated_at.strftime("%B %d, %Y") %> at <%= activity.updated_at.strftime("%r") %></td>
					  <% end %>	
					</tr>
					<% end %>	
					<% end %>
			    <% else %>
			    <tr>
			    	<td>no data</td>
			    	<td>no data</td>
			    </tr>		
				<% end %>	
				</tbody>
			</table>

		</div>
	</div>
</div>

