<!DOCTYPE html>
<html>
<head>
	<title>ReferralSystem</title>
	<%= stylesheet_link_tag    'application', media: 'all' %>
	<%= javascript_include_tag 'application'%>
	<link href="https://maxcdn.bootstrapcdn.com/font-awesome/latest/css/font-awesome.min.css" rel="stylesheet">
	<link href='https://fonts.googleapis.com/css?family=Roboto:400,700,300|Material+Icons' rel='stylesheet' type='text/css'>
	<%= csrf_meta_tags %>
</head>
<body>
	<div class="wrapper">

		<div class="sidebar" data-color="purple" data-image="../assets/img/sidebar-1.jpg">
			<!--
		        Tip 1: You can change the color of the sidebar using: data-color="purple | blue | green | orange | red"

		        Tip 2: you can also add an image using data-image tag
		    -->

		    <div class="logo">
		    	<%= link_to "RECMAN", root_url, class: "simple-text" %>		    </div>

		    <div class="sidebar-wrapper">
		    	<ul class="nav">
		    		<li class="active">
		    			<%= link_to root_url do %>
		    			  <i class="material-icons">dashboard</i>
		    				<p>Dashboard</p>  
		    			<% end %>	
		    		</li>
		    		<% if user_signed_in? %>
		    		<li>
     	    		  <%= link_to edit_user_registration_url do %>
		    		    <i class="material-icons">person</i>
		    				<p>Your Profile</p>
		    		  <% end %>
		    		</li>
		    		<% end %>
		    		<li>
		    		<% if current_user && current_user.approved? %>
		    		  <%= link_to activity_feed_url do %>
		    		    <i class="material-icons">comment</i>
		    		    <p>News Feed</p>
		    		  <% end %>	
		    		<% end %>  
		    		</li>
		    		<li>
		    		<% if current_user && current_user.approved? %>
		    		  <%= link_to user_companies_url(current_user) do %>
		    		    <i class="material-icons">business center</i>
		    		    <p>My Portfolio</p>
		    		  <% end %>	
		    		<% end %>
		    		</li>
		    		<li>
		    		  <% if user_signed_in? && current_user.approved? %>
		    		    <%= link_to messages_url do %>
		    			    <p><i class="material-icons">email</i><span class="badge"><%= Message.where(recipient_id: current_user.id, draft: false, read: false).count %></span> Unread Messages</p>
		    			<% end %>	
		    		  <% end %>  	
		    		</li>
		    		<li>
		    			<% if user_signed_in? && current_user.approved? %>
		    			  <%= link_to user_stats_url do %>
		    			    <p><i class="material-icons">show_chart</i>my stats</p>
		    			  <% end %>
		    			<% end %>
		    		</li>
		    	</ul>
		    </div>
		</div>

		<div class="main-panel">
			<nav class="navbar navbar-transparent navbar-absolute">
				<div class="container-fluid">
					<div class="navbar-header">
						<button type="button" class="navbar-toggle" data-toggle="collapse">
							<span class="sr-only">Toggle navigation</span>
							<span class="icon-bar"></span>
							<span class="icon-bar"></span>
							<span class="icon-bar"></span>
						</button>
						<a class="navbar-brand" href="#">Dashboard</a>
					</div>
					<div class="collapse navbar-collapse">
						<ul class="nav navbar-nav navbar-right">
							<li class="dropdown">
								<a href="#" class="dropdown-toggle" data-toggle="dropdown">
									<i class="material-icons">notifications</i>
									<% if @unseen_notifications.count == 0 %>
									<% else %>
									<span class="notification"><%= @unseen_notifications.count %></span>
									<% end %>
									<p class="hidden-lg hidden-md">Notifications</p>
								</a>
								<% if @all_notifications.any? %>
								<ul class="dropdown-menu" style="min-width: 430px;">
								  <% @all_notifications.last(10).each do |notification| %>
								  <% if_resource_exists?(notification) do %>
								    <% if notification.resource_type == "Company" && notification.action == "contacted" %>
								      <%= link_to mark_notification_as_read_url(notification) do %>
								         <% if notification.read_at.nil? %>
									    <li style="background: #DCDCDC;;">
									    <% else %>
									    <li>
									    <% end %>	
									    <span style="font-weight: bold;">The Agency</span> just <span style="font-weight: bold;">contacted</span> your company<span style="font-weight: bold;">(<%= Company.find(notification.resource_id).company_name %>)</span>
									    </li>
								      <% end %>
								    <% elsif notification.resource_type == "Company" && notification.action == "deal" %>
								      <%= link_to mark_notification_as_read_url(notification) do %>
								        <% if notification.read_at.nil? %>
									    <li style="background: #DCDCDC;;">
									    <% else %>
									    <li>
									    <% end %>	
									    <span style="font-weight: bold;">The Agency</span> just made a <span style="font-weight: bold;">deal</span> with your company<span style="font-weight: bold;">(<%= Company.find(notification.resource_id).company_name %>)</span>
									    </li>
								      <% end %> 
								    <% elsif notification.resource_type == "Company" && notification.action == "authorize" %>
								      <%= link_to mark_notification_as_read_url(notification) do %>
								        <% if notification.read_at.nil? %>
									    <li style="background: #DCDCDC;;">
									    <% else %>
									    <li>
									    <% end %>  
									    <span style="font-weight: bold;">The Agency</span> just approved your updates to your company<span style="font-weight: bold;">(<%= Company.find(notification.resource_id).company_name %>)</span>
									    </li>
								      <% end %>  
								    <% elsif notification.resource_type == "JobDescription" && (notification.action == "posted" || notification.action == "updated") %>
								      <%= link_to mark_notification_as_read_url(notification) do %>
								        <% if notification.read_at.nil? %>
									    <li style="background: #DCDCDC;;">
									    <% else %>
									    <li>
									    <% end %>	
									    <span style="font-weight: bold;"><%= notification.actor_username %></span> just <%= notification.action %> this role: <span style="font-weight: bold;"><%= JobDescription.find(notification.resource_id).job_title %></span> from <span style="font-weight: bold;"><%= JobDescription.find(notification.resource_id).company.company_name %></span></li>    
								      <% end %>    
								    <% elsif notification.resource_type == "JobDescription" && notification.action == "authorize" %>
								      <%= link_to mark_notification_as_read_url(notification) do %>
								        <% if notification.read_at.nil? %>
									    <li style="background: #DCDCDC;;">
									    <% else %>
									    <li>
									    <% end %> 
									    <span style="font-weight: bold;">The Agency</span> just approved your updates to your role: <span style="font-weight: bold;">(<%= JobDescription.find(notification.resource_id).job_title %>)</span>
									    </li>
								      <% end %>  
								    <% elsif notification.resource_type == "Applicant" && notification.action == "created" %>
									  <%= link_to mark_notification_as_read_url(notification) do %>
									    <% if notification.read_at.nil? %>
									    <li style="background: #DCDCDC;;">
									    <% else %>
									    <li>
									    <% end %>
									    <span style="font-weight: bold;"><%= notification.actor_username %></span> just brought in <span style="font-weight: bold;"><%= Applicant.find(notification.resource_id).name %></span> for role as <span style="font-weight: bold;"><%= Applicant.find(notification.resource_id).job_description.job_title %>/<span style="font-weight: bold;"><%= Applicant.find(notification.resource_id).company.company_name %></span></span> </li>    
									  <% end %>  
									<% elsif notification.resource_type == "Applicant" && notification.action == "shortlisted" %>
									  <%= link_to mark_notification_as_read_url(notification) do %>
									    <% if notification.read_at.nil? %>
									    <li style="background: #DCDCDC;;">
									    <% else %>
									    <li>
									    <% end %>
									    <span style="font-weight: bold;"><%= Applicant.find(notification.resource_id).name %></span> has been <span style="font-weight: bold;">shortlisted</span>
									    </li>  
									  <% end %>   
									<% elsif notification.resource_type == "Applicant" && notification.action == "interviewing" %>
									  <%= link_to mark_notification_as_read_url(notification) do %>
									    <% if notification.read_at.nil? %>
									    <li style="background: #DCDCDC;;">
									    <% else %>
									    <li>
									    <% end %>
									    <span style="font-weight: bold;"><%= Applicant.find(notification.resource_id).name %></span> is <span style="font-weight: bold;">interviewing</span>
									    </li>  
									  <% end %>
									<% elsif notification.resource_type == "Applicant" && notification.action == "testing" %>
									  <%= link_to mark_notification_as_read_url(notification) do %>
									    <% if notification.read_at.nil? %>
									    <li style="background: #DCDCDC;;">
									    <% else %>
									    <li>
									    <% end %>
									    <span style="font-weight: bold;"><%= Applicant.find(notification.resource_id).name %></span> is being <span style="font-weight: bold;">examined</span>
									    </li>  
									  <% end %>      
									<% elsif notification.resource_type == "Applicant" && notification.action == "salary negotiation" %>
									  <%= link_to mark_notification_as_read_url(notification) do %>
									    <% if notification.read_at.nil? %>
									    <li style="background: #DCDCDC;;">
									    <% else %>
									    <li>
									    <% end %>
									    <span style="font-weight: bold;"><%= Applicant.find(notification.resource_id).name %></span> is <span style="font-weight: bold;">negotiating salary</span>
									    </li>  
									  <% end %> 
									<% elsif notification.resource_type == "Applicant" && notification.action == "not hired" %>
									  <%= link_to mark_notification_as_read_url(notification) do %>
									    <% if notification.read_at.nil? %>
									    <li style="background: #DCDCDC;;">
									    <% else %>
									    <li>
									    <% end %>
									    <span style="font-weight: bold;"><%= Applicant.find(notification.resource_id).name %></span> was <span style="font-weight: bold;">not hired</span>
									    </li>  
									  <% end %>       
									<% elsif notification.resource_type == "Applicant" && notification.action == "hired" %>
									  <%= link_to mark_notification_as_read_url(notification) do %>
									    <% if notification.read_at.nil? %>
									    <li style="background: #DCDCDC;;">
									    <% else %>
									    <li>
									    <% end %>
									    <% if Applicant.find(notification.resource_id).user == current_user %>  
									      <span style="font-weight: bold;"><%= Applicant.find(notification.resource_id).name %></span> has been <span style="font-weight: bold;">hired</span>
									    <% else %>
									      <span style="font-weight: bold;"><%= Applicant.find(notification.resource_id).name %></span> who applied to your role(<span style="font-weight: bold;"><%= Applicant.find(notification.resource_id).job_description.job_title %></span>/<span style="font-weight: bold;"><%= Applicant.find(notification.resource_id).company.company_name %></span>) has been <span style="font-weight: bold;">hired</span>. 
									    <% end %>  
									    </li>  
									  <% end %>   
									<% elsif notification.resource_type == "Qualification" && notification.action == "authorize" %>
									  <%= link_to mark_notification_as_read_url(notification) do %>
									    <% if notification.read_at.nil? %>
									    <li style="background: #DCDCDC;;">
									    <% else %>
									    <li>
									    <% end %> 
									    <span style="font-weight: bold;">The Agency</span> just approved your updates to your job description: <span style="font-weight: bold;">(<%= JobDescription.find(Qualification.find(notification.resource_id).job_description_id).job_title %>/<%= JobDescription.find(Qualification.find(notification.resource_id).job_description_id).company.company_name %>)</span>
									    </li>
									  <% end %>  
									<% elsif notification.resource_type == "RequiredExperience" && notification.action == "authorize" %>
									  <%= link_to mark_notification_as_read_url(notification) do %>
									    <% if notification.read_at.nil? %>
									    <li style="background: #DCDCDC;;">
									    <% else %>
									    <li>
									    <% end %> 
									    <span style="font-weight: bold;">The Agency</span> just approved your updates to your job description: <span style="font-weight: bold;">(<%= JobDescription.find(RequiredExperience.find(notification.resource_id).job_description_id).job_title %>/<%= JobDescription.find(RequiredExperience.find(notification.resource_id).job_description_id).company.company_name %>)</span>
									    </li>
									  <% end %>     
									<% elsif notification.resource_type == "Requirement" && notification.action == "authorize" %>
									  <%= link_to mark_notification_as_read_url(notification) do %>
									    <% if notification.read_at.nil? %>
									    <li style="background: #DCDCDC;;">
									    <% else %>
									    <li>
									    <% end %>  
									    <span style="font-weight: bold;">The Agency</span> just approved your updates to your job description: <span style="font-weight: bold;">(<%= JobDescription.find(Requirement.find(notification.resource_id).job_description_id).job_title %>/(<%= JobDescription.find(Requirement.find(notification.resource_id).job_description_id).company.company_name %>)</span>
									    </li> 
									  <% end %> 
									<% elsif notification.resource_type == "Applicant" && notification.action == "authorize" %>
									  <%= link_to mark_notification_as_read_url(notification) do %>
									    <% if notification.read_at.nil? %>
									    <li style="background: #DCDCDC;;">
									    <% else %>
									    <li>
									    <% end %>  
									    <span style="font-weight: bold;">The Agency</span> just approved your updates to your applicant: <span style="font-weight: bold;"><%= Applicant.find(notification.resource_id).name %>/<%= JobDescription.find(Applicant.find(notification.resource_id).job_description_id).job_title %>)</span>
									    </li>  
									  <% end %>                                     
								    <% end %> 
								    <% end %>
								  <% end %>	
								</ul>
								<% end %>
							</li>
							<li>
							  <% if user_signed_in? %>
							  <%= link_to destroy_user_session_url, method: :delete, data: { confirm: "Are you sure you want to sign out?" }, class: "btn btn-primary btn-xs btn-round" do %>
							    <i class="material-icons">person</i> 
							    Log out,
							    <%= current_user.username %>
							  <% end %>
							  <% else %>     
								<%= link_to new_user_session_url, class: "btn btn-primary btn-xs btn-round" do %>
							      <i class="material-icons">person</i>Log In
								<% end %>
							  <% end %>	
							</li>
						</ul>
					</div>
				</div>
			</nav>
			<div class="content">
				<div class="container-fluid">
					<div class="row">


						<% flash.each do |key, message| %>
						<div id="flash" class="alert alert-<%= key %>">
							<%= message %>
						</div>
						<% end %>
						<%= yield %>
					</div>
				</div>
			</div>
		</body>
		<%= javascript_include_tag "jquery-3.1.0.min" %>
		<%= javascript_include_tag "bootstrap.min" %>
		<%= javascript_include_tag "material.min" %>
		<%= javascript_include_tag "chartist.min" %>
		<%= javascript_include_tag "bootstrap-notify" %>
		<%= javascript_include_tag "material-dashboard" %>

		<script type="text/javascript">
        $('.dropdown').click(function(e) {
        	$.ajax({
        	  method: "GET",
        	  url: "/notifications/mark_all_as_seen",
        	  dataType: "JSON",
        	  success: function (){
        	  	$('.notification').remove();
        	  }
        	})
        });
	    </script>

	    <script type="text/javascript">
	    	$(document).ready(function(){
	    		setTimeout(function(){
	    			$('#flash').fadeOut(5000);
	    		}, 5000);
	    	}); 	
	    </script>
	</html>
